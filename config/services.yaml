services:
    _defaults:
        autowire: true
        autoconfigure: true

    # UserInterface: CLI

    AML\UserInterface\CLI\Command\:
        resource: '../src/UserInterface/CLI/Command'

    # Infrastructure

    AML\Infrastructure\Application\Command\CommandSerializer:
      class: AML\Infrastructure\Application\Command\SymfonyJSONCommandSerializer

    AML\Infrastructure\Application\Command\SymfonyJSONCommandSerializer:
      public: true
      class: AML\Infrastructure\Application\Command\SymfonyJSONCommandSerializer

    AML\Infrastructure\Application\Command\CommandConsumer:
      class: AML\Infrastructure\Application\Command\CommandConsumer

    AML\Application\Bus\CommandBus:
      class: AML\Infrastructure\Application\Command\SimpleBusSyncCommandBus
      arguments: ['@simple_bus.command_bus']

    AML\Infrastructure\Queue\QueueService:
      class: AML\Infrastructure\Queue\Beanstalkd\BeanstalkdQueue
      arguments: ['%beanstalkd.host%', '%beanstalkd.port%', '%beanstalkd.timeout%', '%beanstalkd.tube.async-process-event%']

    # Application layer

    AML\Application\Service\:
        resource: '../src/Application/Service'
        exclude: '*Input.php'

    AML\Application\Bus\MyHandler:
      class: AML\Application\Bus\MyHandler
      tags:
        - { name: command_handler, handles: MediaManager\Application\Bus\ProcessPageCommand }

    # Domain layer

    AML\Domain\Repository\SearchUrlRepository:
        class: AML\Infrastructure\Domain\Repository\SymfonyCrawlerUrlRepository
        arguments: ['@Symfony\Contracts\HttpClient\HttpClientInterface']

    AML\Domain\Repository\InfoUrlRepository:
        class: AML\Infrastructure\Domain\Repository\DoctrineInfoUrlRepository
        factory: ["@doctrine", getRepository]
        arguments: ["DomainModel:Page"]

    # Third party

    Psr\Log\LoggerInterface:
        factory: '@monolog.logger'

    Symfony\Contracts\HttpClient\HttpClientInterface:
        factory: Symfony\Component\HttpClient\HttpClient::create
